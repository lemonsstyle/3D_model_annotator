<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <!-- ç¦æ­¢ç¼“å­˜ç›¸å…³çš„metaæ ‡ç­¾ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ä¸‰ç»´æ¨¡å‹æ ‡æ³¨æŸ¥çœ‹å™¨</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        #refresh-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: none;
            color: white;
            border: none;
            font-size: 14px;
            cursor: pointer;
            z-index: 9999;
            padding: 5px 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            transition: all 0.2s ease;
        }
        #refresh-button:hover {
            color: #ffcc00;
            transform: scale(1.05);
        }
        
        /* æ·»åŠ åŠ è½½çŠ¶æ€æç¤ºæ ·å¼ */
        #loading-status {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 9990;
            max-width: 80%;
            display: none; /* éšè—å·¦ä¸‹æ–¹çš„åŠ è½½çŠ¶æ€æç¤º */
        }
        
        /* æ·»åŠ è°ƒè¯•ä¿¡æ¯åŒºåŸŸæ ·å¼ */
        #debug-info {
            display: none;
            position: fixed;
            top: 70px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9995;
            max-width: 300px;
            max-height: 200px;
            overflow: auto;
        }
        
        /* æ·»åŠ è°ƒè¯•å¼€å…³æŒ‰é’®æ ·å¼ */
        #debug-toggle {
            position: fixed;
            top: 20px;
            left: 110px;
            background: none;
            color: white;
            border: none;
            font-size: 14px;
            cursor: pointer;
            z-index: 9999;
            padding: 5px 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            transition: all 0.2s ease;
        }
        #debug-toggle:hover {
            color: #ffcc00;
        }
    </style>
</head>
<body>
    <div id="info">
        <h1>ä¸‰ç»´æ¨¡å‹æ•™å­¦æŸ¥çœ‹</h1>
    </div>
    <div id="model-container"></div>
    
    <!-- å¼ºåˆ¶åˆ·æ–°æŒ‰é’® -->
    <button id="refresh-button" onclick="forceRefresh()" title="å¼ºåˆ¶åˆ·æ–°é¡µé¢å¹¶æ¸…é™¤ç¼“å­˜&#10;å¦‚é‡åˆ°æ¨¡å‹åŠ è½½ä¸æ­£ç¡®æˆ–æ˜¾ç¤ºé—®é¢˜ï¼Œè¯·ç‚¹å‡»æ­¤æŒ‰é’®">
        <span class="desktop-text">å¼ºåˆ¶åˆ·æ–°</span>
        <span class="mobile-icon">ğŸ”„</span>
    </button>
    
    <!-- åŠ è½½çŠ¶æ€æç¤º (å·²éšè—) -->
    <div id="loading-status">æ­£åœ¨åŠ è½½åº”ç”¨...</div>
    
    <!-- è°ƒè¯•ä¿¡æ¯åŒºåŸŸ (é»˜è®¤éšè—) -->
    <div id="debug-info"></div>
    
    <!-- è°ƒè¯•å¼€å…³æŒ‰é’® -->
    <button id="debug-toggle" onclick="toggleDebugInfo()" title="æ˜¾ç¤º/éšè—è°ƒè¯•ä¿¡æ¯">
        <span class="desktop-text">è°ƒè¯•ä¿¡æ¯</span>
        <span class="mobile-icon">ğŸ›</span>
    </button>
    
    <!-- ç½‘ç»œçŠ¶æ€æ˜¾ç¤ºå·²éšè— -->
    <!-- <div id="network-status" style="position: fixed; top: 10px; right: 10px; padding: 5px; background: rgba(0,0,0,0.7); color: white; border-radius: 5px;"></div> -->
    
    <!-- Three.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/PLYLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/geometries/TextGeometry.js"></script>
    
    <!-- å¼ºåˆ¶åˆ·æ–°å‡½æ•° -->
    <script>
        function forceRefresh() {
            // æ¸…é™¤localStorageä¸­çš„ç¼“å­˜ç‰ˆæœ¬
            localStorage.removeItem('cacheVersion');
            
            // æ¸…é™¤åº”ç”¨ç¼“å­˜
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) caches.delete(name);
                });
            }
            
            // å¼ºåˆ¶åˆ·æ–°é¡µé¢ï¼Œç»•è¿‡ç¼“å­˜
            window.location.reload(true);
        }
    </script>
    
    <!-- ç›´æ¥å¼•å…¥main.jsï¼Œä¸ä½¿ç”¨åŠ¨æ€åŠ è½½ -->
    <script src="js/main.js"></script>

    <!-- è°ƒè¯•å’Œæ—¥å¿—åŠŸèƒ½ -->
    <script>
        // æ›´æ–°åŠ è½½çŠ¶æ€çš„è¾…åŠ©å‡½æ•°
        function updateLoadingStatus(message) {
            // ä¸å†æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ï¼Œå› ä¸ºä¸­å¤®å·²æœ‰åŠ è½½æŒ‡ç¤ºå™¨
            // const status = document.getElementById('loading-status');
            // if (status) {
            //     status.textContent = message;
            // }
        }
        
        // æ·»åŠ è°ƒè¯•ä¿¡æ¯çš„è¾…åŠ©å‡½æ•°
        function addDebugInfo(message) {
            const debug = document.getElementById('debug-info');
            if (debug) {
                // ä¸å†è‡ªåŠ¨æ˜¾ç¤ºè°ƒè¯•åŒºåŸŸ
                // debug.style.display = 'block';
                
                const line = document.createElement('div');
                line.textContent = message;
                debug.appendChild(line);
                
                // ä¿æŒæœ€æ–°æ¶ˆæ¯å¯è§
                debug.scrollTop = debug.scrollHeight;
                
                // é™åˆ¶è°ƒè¯•ä¿¡æ¯æ•°é‡ï¼Œé˜²æ­¢è¿‡å¤š
                if (debug.children.length > 100) {
                    debug.removeChild(debug.firstChild);
                }
            }
        }
        
        // æ˜¾ç¤ºæ¥å£è°ƒç”¨å¤±è´¥æ—¶çš„è¾…åŠ©ä¿¡æ¯
        function showApiFailureHelp() {
            updateLoadingStatus('APIè¯·æ±‚å¤±è´¥ - è¯·è€ƒè™‘ä½¿ç”¨PythonæœåŠ¡å™¨');
            addDebugInfo('æç¤ºï¼šä½¿ç”¨http-serveræ—¶æ— æ³•å¤„ç†APIè¯·æ±‚');
            addDebugInfo('å»ºè®®: ä½¿ç”¨ python server.py å¯åŠ¨æœåŠ¡å™¨');
            addDebugInfo('æ­£åœ¨å°è¯•ç›´æ¥åŠ è½½æ¨¡å‹...');
            
            // APIå¤±è´¥æ˜¯é‡è¦é”™è¯¯ï¼Œè‡ªåŠ¨æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            document.getElementById('debug-info').style.display = 'block';
        }
        
        // ç›‘å¬é”™è¯¯äº‹ä»¶
        window.addEventListener('error', function(event) {
            addDebugInfo('é”™è¯¯: ' + event.message);
            console.error('é¡µé¢é”™è¯¯: ' + event.message);
        });
        
        // é‡å†™console.logå’Œconsole.errorä»¥æ•è·è°ƒè¯•ä¿¡æ¯
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function() {
            originalLog.apply(console, arguments);
            addDebugInfo('LOG: ' + Array.from(arguments).join(' '));
        };
        
        console.error = function() {
            originalError.apply(console, arguments);
            addDebugInfo('ERROR: ' + Array.from(arguments).join(' '));
        };
        
        // åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºåŠ è½½å®Œæˆ
        console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆï¼Œç­‰å¾…JavaScriptåŠ è½½...');
    </script>
    
    <!-- è°ƒè¯•å¼€å…³å‡½æ•° -->
    <script>
        let debugEnabled = false;
        
        function toggleDebugInfo() {
            debugEnabled = !debugEnabled;
            const debug = document.getElementById('debug-info');
            const toggleBtn = document.getElementById('debug-toggle');
            
            if (debug) {
                if (debugEnabled) {
                    debug.style.display = 'block';
                    toggleBtn.style.backgroundColor = 'rgba(0, 128, 255, 0.8)'; // è“è‰²è¡¨ç¤ºæ¿€æ´»
                } else {
                    debug.style.display = 'none';
                    toggleBtn.style.backgroundColor = 'rgba(0, 0, 0, 0.6)'; // æ¢å¤é»˜è®¤é¢œè‰²
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåä¸è‡ªåŠ¨æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        window.addEventListener('load', function() {
            console.log('é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ');
            // è°ƒè¯•ä¿¡æ¯é»˜è®¤éšè—ï¼Œéœ€è¦æ‰‹åŠ¨ç‚¹å‡»æŸ¥çœ‹
            // toggleDebugInfo();
        });
    </script>
    
    <!-- ç½‘ç»œçŠ¶æ€æ£€æµ‹å·²ç¦ç”¨ -->
    <script>
        // ç½‘ç»œçŠ¶æ€æ£€æµ‹åŠŸèƒ½å·²éšè—
        /*
        function checkNetworkStatus() {
            const status = document.getElementById('network-status');
            if (navigator.onLine) {
                status.textContent = 'ç½‘ç»œçŠ¶æ€: å·²è¿æ¥';
                status.style.color = 'green';
            } else {
                status.textContent = 'ç½‘ç»œçŠ¶æ€: æœªè¿æ¥';
                status.style.color = 'red';
            }
        }

        // æ·»åŠ ç½‘ç»œçŠ¶æ€ç›‘å¬å™¨
        window.addEventListener('online', checkNetworkStatus);
        window.addEventListener('offline', checkNetworkStatus);
        */
        
        // é¡µé¢åŠ è½½æ—¶è¿›è¡ŒæœåŠ¡å™¨è¿æ¥æµ‹è¯•ï¼ˆä¿ç•™è¿æ¥æµ‹è¯•åŠŸèƒ½ï¼Œä½†ä¸æ˜¾ç¤ºç½‘ç»œçŠ¶æ€ï¼‰
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥æœåŠ¡å™¨è¿æ¥...');
            
            // æµ‹è¯•æœåŠ¡å™¨è¿æ¥
            fetch('/api/models')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('æœåŠ¡å™¨è¿æ¥æˆåŠŸ');
                    addDebugInfo('æœåŠ¡å™¨è¿æ¥æˆåŠŸ');
                })
                .catch(error => {
                    console.error('æœåŠ¡å™¨è¿æ¥å¤±è´¥:', error);
                    addDebugInfo(`æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`);
                    addDebugInfo('è¯·ç¡®ä¿:');
                    addDebugInfo('1. æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ');
                    addDebugInfo('2. è®¾å¤‡ä¸æœåŠ¡å™¨åœ¨åŒä¸€å±€åŸŸç½‘');
                    addDebugInfo('3. é˜²ç«å¢™æœªé˜»æ­¢è¿æ¥');
                });
        });
    </script>
</body>
</html> 